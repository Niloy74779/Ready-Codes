(function(){var Bump,HALF_PI,PI,Paper,Pattern,Scene,Shapes,Spring,Sprites,TWO_PI,aspect,atan2,camera,ceil,chance,clock,composer,cos,distance,drag,floor,height,init,max,min,mousedown,mousemove,mouseup,random,renderer,resize,round,scale,scene,sin,sqrt,stats,tan,themes,update,utils,width,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice1=[].slice;Bump=function(){var canvas,ctx,image,texture;canvas=document.createElement("canvas");texture=new THREE.Texture(canvas);image=new Image;ctx=canvas.getContext("2d");image.onload=function(_this){return function(){return Bump.setSize(1e3,1e3)}}(this);image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAAAAAAZai4+AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExOERCQkU5NDlERjhCOTJBOSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowQjQxMTY3QTIyNzExMUUyQjJCN0FFRTdDNTkwOEVBMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowQjQxMTY3OTIyNzExMUUyQjJCN0FFRTdDNTkwOEVBMyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M0IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAxODAxMTc0MDcyMDY4MTE4REJCRTk0OURGOEI5MkE5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAxODAxMTc0MDcyMDY4MTE4REJCRTk0OURGOEI5MkE5Ii8+IDwvcmRmOkRlc2NyaXB0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";canvas.style.display="none";document.body.appendChild(canvas);return{setSize:function(width,height){canvas.width=width;canvas.height=height;ctx.fillStyle=ctx.createPattern(image,"repeat");ctx.fillRect(0,0,width,height);return texture.needsUpdate=true},texture:texture,canvas:canvas}}();(function(){var browserRaf,canceled,j,len,ref,targetTime,vendor,w;w=window;ref=["ms","moz","webkit","o"];for(j=0,len=ref.length;j<len;j++){vendor=ref[j];if(w.requestAnimationFrame){break}w.requestAnimationFrame=w[vendor+"RequestAnimationFrame"];w.cancelAnimationFrame=w[vendor+"CancelAnimationFrame"]||w[vendor+"CancelRequestAnimationFrame"]}if(w.requestAnimationFrame){if(w.cancelAnimationFrame){return}browserRaf=w.requestAnimationFrame;canceled={};w.requestAnimationFrame=function(callback){var id;return id=browserRaf(function(time){if(id in canceled){return delete canceled[id]}else{return callback(time)}})};return w.cancelAnimationFrame=function(id){return canceled[id]=true}}else{targetTime=0;w.requestAnimationFrame=function(callback){var currentTime;targetTime=Math.max(targetTime+16,currentTime=+new Date);return w.setTimeout(function(){return callback(+new Date)},targetTime-currentTime)};return w.cancelAnimationFrame=function(id){return clearTimeout(id)}}})();PI=Math.PI;TWO_PI=PI*2;HALF_PI=PI/2;min=Math.min;max=Math.max;sin=Math.sin;cos=Math.cos;tan=Math.tan;atan2=Math.atan2;round=Math.round;floor=Math.floor;ceil=Math.ceil;sqrt=Math.sqrt;chance=function(probability){return Math.random()<probability};random=function(min,max){if(min&&typeof min.length==="number"&&min.length!=null){return min[floor(Math.random()*min.length)]}if(typeof max!=="number"){max=min||1;min=0}return min+Math.random()*(max-min)};Paper=function(superClass){extend(Paper,superClass);Paper.prototype.cols=10;Paper.prototype.rows=10;Paper.prototype.bump=Bump.texture;Paper.prototype.environment=THREE.ImageUtils.loadTextureCube(["build/img/skybox/px.jpg","build/img/skybox/nx.jpg","build/img/skybox/py.jpg","build/img/skybox/ny.jpg","build/img/skybox/pz.jpg","build/img/skybox/nz.jpg"]);function Paper(){Paper.__super__.constructor.apply(this,arguments);this.gravity=0;this.stiffness=.6;this.anchors=[];this.targetPosition=this.position.clone();this.material=new THREE.MeshPhongMaterial({shininess:500,ambient:3355443,color:13421772,specular:6710886,bumpMap:this.bump,perPixel:false,wrapAround:true,bumpScale:.5,metal:true,envMap:this.environment,reflectivity:1});this.material.side=THREE.DoubleSide;this.build()}Paper.prototype.build=function(){var height,radians,width;this.position.y=0;if(this.mesh!=null){this.remove(this.mesh);renderer.deallocateObject(this.mesh)}radians=camera.fov*HALF_PI/180;height=tan(radians)*(camera.position.z-this.position.z)*2;width=height*camera.aspect;this.geometry=new THREE.PlaneGeometry(width,height,this.cols,this.rows);this.mesh=new THREE.Mesh(this.geometry,this.material);this.mesh.receiveShadow=true;this.mesh.castShadow=true;this.mesh.receiveShadow=true;this.mesh.castShadow=true;this.add(this.mesh);return this.initPhysics()};Paper.prototype.initPhysics=function(){var a,b,c,d,face,faces,j,k,len,len1,results,vertex,vertices;this.springs=[];vertices=this.geometry.vertices;faces=this.geometry.faces;for(j=0,len=vertices.length;j<len;j++){vertex=vertices[j];vertex.z=random(40);vertex.makeParticle()}results=[];for(k=0,len1=faces.length;k<len1;k++){face=faces[k];a=vertices[face.a];b=vertices[face.b];c=vertices[face.c];d=vertices[face.d];this.springs.push(new Spring(a,d,a.distanceTo(d),this.stiffness));this.springs.push(new Spring(b,c,b.distanceTo(c),this.stiffness));this.springs.push(new Spring(a,b,a.distanceTo(b),this.stiffness));this.springs.push(new Spring(d,c,d.distanceTo(c),this.stiffness));this.springs.push(new Spring(a,c,a.distanceTo(c),this.stiffness));results.push(this.springs.push(new Spring(b,d,b.distanceTo(d),this.stiffness)))}return results};Paper.prototype.changePattern=function(){var artwork;Pattern.setSize(width,height);Bump.setSize(width,height);Pattern.draw();this.material.bumpScale=random(.5,1.5);this.material.reflectivity=random(.2,.9);this.material.bump=new THREE.Texture(Bump.canvas);this.material.bump.needsUpdate=true;if(Pattern.generation<2){artwork=Pattern.cloneCanvas()}else{artwork=Pattern.canvas}this.material.map=new THREE.Texture(artwork);return this.material.map.needsUpdate=true};Paper.prototype.moveTo=function(vec){this.targetPosition.copy(vec);return this.position.copy(vec)};Paper.prototype.easeTo=function(vec){return this.targetPosition.copy(vec)};Paper.prototype.drop=function(){var anchor,distance,j,len,ref,spring,vertex;anchor=new THREE.Vector3(random(-2e3,2e3),0,random(2e3));anchor.makeParticle();anchor.springs=[];ref=this.geometry.vertices;for(j=0,len=ref.length;j<len;j++){vertex=ref[j];distance=anchor.distanceTo(vertex)*random(.8,1);spring=new Spring(anchor,vertex,distance,.05);anchor.springs.push(spring);this.springs.push(spring)}return this.anchors.push(anchor)};Paper.prototype.update=function(dtSq){var anchor,j,k,len,len1,len2,len3,n,q,ref,ref1,ref2,ref3,results,spring,vertex;ref=this.anchors;for(j=0,len=ref.length;j<len;j++){anchor=ref[j];anchor.y-=500}this.position.z+=(this.targetPosition.z-this.position.z)*.2;ref1=this.geometry.vertices;for(k=0,len1=ref1.length;k<len1;k++){vertex=ref1[k];vertex.integrate(dtSq)}ref2=this.springs;for(n=0,len2=ref2.length;n<len2;n++){spring=ref2[n];spring.update()}this.geometry.verticesNeedUpdate=true;ref3=this.geometry.vertices;results=[];for(q=0,len3=ref3.length;q<len3;q++){vertex=ref3[q];results.push(vertex.z=max(-20,vertex.z))}return results};Paper.prototype.resize=function(){};Paper.prototype.destroy=function(){return this.springs=[]};return Paper}(THREE.Object3D);Pattern=function(){var Branch,augment,background,callbacks,ctx,distribute,fbo,height,makeVariants,pallette,ready,repeat,sprite,tile,width;augment=function(ctx){ctx.fbo=document.createElement("canvas").getContext("2d");ctx.randomFillStyle=function(colors){var h,l,ref,s;ref=random(colors),h=ref[0],s=ref[1],l=ref[2];return this.fillStyle="hsl("+h+","+s+"%,"+l+"%)"};ctx.randomStrokeStyle=function(colors){var h,l,ref,s;ref=random(colors),h=ref[0],s=ref[1],l=ref[2];return this.strokeStyle="hsl("+h+","+s+"%,"+l+"%)"};ctx.randomFillStrokeStyle=function(colors){var h,l,ref,s;ref=random(colors),h=ref[0],s=ref[1],l=ref[2];return this.strokeStyle=this.fillStyle="hsl("+h+","+s+"%,"+l+"%)"};ctx.drawPath=function(path,jitter){var j,len,p;if(jitter==null){jitter=0}this.beginPath();for(j=0,len=path.length;j<len;j++){p=path[j];this.lineTo(p.x+random(-jitter,jitter),p.y+random(-jitter,jitter))}return this.closePath()};ctx.drawShape=function(shape,jitter){var cmd,j,len,o,p,pts,step;if(jitter==null){jitter=0}o=jitter/2;this.beginPath();for(j=0,len=shape.length;j<len;j++){step=shape[j];cmd=step[0];pts=step.slice(1);this[cmd].apply(ctx,function(){var k,len1,results;results=[];for(k=0,len1=pts.length;k<len1;k++){p=pts[k];results.push(p+random(-o,o))}return results}())}return this.closePath()};ctx.curveThroughPoints=function(points){var a,b,i,j,ref,x,y;for(i=j=1,ref=points.length-3;1<=ref?j<=ref:j>=ref;i=1<=ref?++j:--j){a=points[i];b=points[i+1];x=(a.x+b.x)*.5;y=(a.y+b.y)*.5;this.quadraticCurveTo(a.x,a.y,x,y)}a=points[i];b=points[i+1];console.log(i,a,b);return this.quadraticCurveTo(a.x,a.y,b.x,b.y)};ctx.drawTintedImage=function(){var args,img,tint;img=arguments[0],tint=arguments[1],args=3<=arguments.length?slice1.call(arguments,2):[];ctx.fbo.canvas.width=img.width;ctx.fbo.canvas.height=img.height;ctx.fbo.fillStyle=tint;ctx.fbo.fillRect(0,0,img.width,img.height);ctx.fbo.globalCompositeOperation="destination-in";ctx.fbo.drawImage(img,0,0);return this.drawImage.apply(this,[ctx.fbo.canvas].concat(args))};ctx.dot=function(x,y,radius){this.beginPath();this.arc(x,y,radius,0,TWO_PI);return this.closePath()};ctx.tri=function(x1,y1,x2,y2,x3,y3){this.beginPath();this.moveTo(x1,y1);this.lineTo(x2,y2);this.lineTo(x3,y3);return this.closePath()};ctx.rect=function(x,y,width,height){this.beginPath();this.moveTo(x,y);this.lineTo(x+width,y);this.lineTo(x+width,y+height);this.lineTo(x,y+height);return this.closePath()};return ctx};makeVariants=function(hsl,count,jitter){var h,ho,i,j,l,lo,ref,s,so,variants;if(jitter==null){jitter=.1}ho=jitter*180;so=lo=jitter*50;variants=[];for(i=j=0,ref=count;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j){h=hsl[0]+random(-ho,ho);s=hsl[1]+random(-so,so);l=hsl[2]+random(-lo,lo);variants.push([h,s,l])}return variants};repeat=function(sx,sy,fn){var j,ox,oy,ref,ref1,ref2,results,x,y;ox=sx===width?0:-sx;oy=sy===height?0:-sy;results=[];for(y=j=ref=height,ref1=oy,ref2=-sy;ref2>0?j<=ref1:j>=ref1;y=j+=ref2){results.push(function(){var k,ref3,ref4,ref5,results1;results1=[];for(x=k=ref3=width,ref4=ox,ref5=-sx;ref5>0?k<=ref4:k>=ref4;x=k+=ref5){ctx.save();ctx.translate(x,y);fn(ctx,x,y);results1.push(ctx.restore())}return results1}())}return results};tile=function(sx,sy,sw,sh,fn){fbo.canvas.width=sw;fbo.canvas.height=sh;fn(fbo);return repeat(sx,sy,function(ctx){return ctx.drawImage(fbo.canvas,0,0)})};distribute=function(density,w,h,fn){var count,i,j,ref,results;count=sqrt(w*h)*density;results=[];for(i=j=0,ref=count;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j){ctx.save();ctx.translate(random(w),random(h));fn(ctx);results.push(ctx.restore())}return results};Branch=function(){function Branch(tree1,x4,y4,theta1,thickness1,decay,generation){this.tree=tree1!=null?tree1:[];this.x=x4!=null?x4:0;this.y=y4!=null?y4:0;this.theta=theta1!=null?theta1:0;this.thickness=thickness1!=null?thickness1:5;this.decay=decay!=null?decay:1;this.generation=generation!=null?generation:0;this.growing=true;this.path=[{x:this.x,y:this.y,t:this.thickness}]}Branch.prototype.grow=function(){var angle;this.x+=this.thickness*cos(this.theta);this.y+=this.thickness*sin(this.theta);this.path.push({x:this.x,y:this.y,t:this.thickness});this.decay*=.8;if(this.decay<.1){this.growing=false}if(this.growing&&this.generation<2&&chance(.2)){angle=this.theta+PI/4*(this.generation!==0&&chance(.5)?1:-1);return this.tree.push(new Branch(this.tree,this.x,this.y,angle,this.thickness-3,this.decay,this.generation+1))}};return Branch}();ctx=augment(document.createElement("canvas").getContext("2d"));fbo=augment(document.createElement("canvas").getContext("2d"));background="#ffffff";pallette=[];height=ctx.canvas.height;width=ctx.canvas.width;ready=false;callbacks=[];sprite=new Image;sprite.onload=function(){var fn,j,len,results;ready=true;results=[];for(j=0,len=callbacks.length;j<len;j++){fn=callbacks[j];results.push(fn())}return results};return{pattern:"tri",canvas:ctx.canvas,generation:0,ready:function(fn){if(ready){return fn()}else{return callbacks.push(fn)}},setSize:function(w,h){width=w;return height=h},draw:function(label){var color,message,metrics,pattern,s,size,theme;if(label==null){label=false}ctx.canvas.width=width*scale;ctx.canvas.height=height*scale;ctx.scale(scale,scale);theme=this.generation===0?themes[0]:random(themes);pallette=function(){var j,len,results;results=[];for(j=0,len=theme.length;j<len;j++){color=theme[j];results.push(utils.hex2hsl(color))}return results}();background=pallette.splice(random(pallette.length|0),1)[0];ctx.fillStyle="hsl("+background[0]+","+background[1]+"%,"+background[2]+"%)";ctx.fillRect(0,0,width,height);if(this.generation===0){this.patterns.star();message="UNWRAP ME!";s=width>700?7:4;ctx.restore();ctx.translate(width*.5,height*.5);ctx.scale(s,s);ctx.rotate((chance(.5)?1:-1)*random(.2,.3));ctx.globalAlpha=.9;ctx.font="40px; Arial+Bold";ctx.textBaseline="middle";ctx.textAlign="center";metrics=ctx.measureText(message);size=metrics.width+4;ctx.fillStyle="#000";ctx.fillRect(size*-.5,-7,size,15);ctx.fillStyle="#fff";ctx.fillText(message,0,0)}else{if(this.generation>10&&chance(.5)){this.special.doom()}else{this.patterns[random(function(){var results;results=[];for(pattern in this.patterns){results.push(pattern)}return results}.call(this))]()}}return this.generation++},cloneCanvas:function(){var copyCanvas,copyCtx;copyCanvas=document.createElement("canvas");copyCanvas.height=ctx.canvas.height;copyCanvas.width=ctx.canvas.width;copyCtx=copyCanvas.getContext("2d");copyCtx.drawImage(ctx.canvas,0,0);return copyCanvas},special:{doom:function(){var size;sprite=Sprites.random();size=random(200,280);return repeat(size,size,function(ctx){var h,l,ref,s;ref=random(pallette),h=ref[0],s=ref[1],l=ref[2];return ctx.drawTintedImage(sprite,"hsl("+h+","+s+"%,"+l+"%)",0,0)})}},patterns:{snowman:function(){var randomCol,size,variants;size=random(180,400);randomCol=chance(.5);variants=makeVariants(random(pallette),100,.1);if(chance(.7)){distribute(random(.02,.05),width,height,function(ctx){var i,j,length,ref,results,sides,theta;sides=round(random(3,5));theta=PI/sides;length=random(4,20);ctx.lineWidth=random(1,5);ctx.rotate(random(TWO_PI));ctx.randomStrokeStyle(variants);results=[];for(i=j=1,ref=sides;1<=ref?j<=ref:j>=ref;i=1<=ref?++j:--j){ctx.beginPath();ctx.moveTo(-(length*random(.8,1.2)),0);ctx.lineTo(length*random(.8,1.2),0);ctx.stroke();results.push(ctx.rotate(theta+random(-.05,.05)))}return results})}return repeat(size,size,function(ctx){var arm,armAngle,armLength,bodyRadius,dx,dy,ep1,ep2,eyeRadius,fingerLength,h,headRadius,l,sx,sy;
ctx.shadowColor="rgba(0,0,0,0.2)";ctx.shadowOffsetX=0;ctx.shadowOffsetY=1;if(randomCol&&chance(.8)){ctx.randomFillStyle(variants)}else{ctx.fillStyle="#fff"}headRadius=random(20,40);bodyRadius=headRadius*random(1.2,2);eyeRadius=headRadius*random(.1,.2);ctx.dot(0,bodyRadius*random(.9,1.2),bodyRadius);ctx.fill();ctx.dot(0,0,headRadius);ctx.fill();ep1={x:headRadius*random(-.2,-.5),y:headRadius*random(-.4,.1)};ep2={x:headRadius*random(.2,.5),y:headRadius*random(-.4,.1)};ctx.fillStyle="#000";ctx.dot(ep1.x,ep1.y,eyeRadius*random(.8,1.2));ctx.fill();ctx.dot(ep2.x,ep2.y,eyeRadius*random(.8,1.2));ctx.fill();sx=random(10,25);sy=random(3,6);dx=ep2.x-ep1.x;dy=ep2.y-ep1.y;ctx.save();ctx.translate(ep1.x+dx/2,ep1.y+dy/2);ctx.rotate(HALF_PI+random(-.2,.2)+atan2(dy,dx));ctx.translate(random(5,10),0);ctx.tri(0,-sy,sx,0,0,sy);h=random(30,40);l=random(45,60);ctx.fillStyle="hsl("+h+",100%,"+l+"%)";ctx.fill();ctx.restore();armLength=bodyRadius*random(.35,.5);fingerLength=armLength*random(.4,.6);armAngle=PI*random(-.1,.1);arm=function(dir){if(dir==null){dir=1}ctx.strokeStyle="#000";ctx.lineWidth=random(3,5);ctx.save();ctx.scale(dir,1);ctx.beginPath();ctx.translate(bodyRadius*random(.8,.9),bodyRadius*random(.7,1.1));ctx.rotate(armAngle);ctx.moveTo(0,0);ctx.lineTo(armLength,0);ctx.stroke();ctx.translate(armLength*random(.5,1),0);ctx.rotate(PI*random(-.2,-.3));ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(fingerLength*random(.8,1.2),0);ctx.lineWidth*=.8;ctx.stroke();ctx.translate(random(-2,2),0);ctx.rotate(HALF_PI);ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(fingerLength*random(.8,1.2),0);ctx.stroke();return ctx.restore()};arm(-1);return arm(1)})},box:function(){var composite,hc,size,vc;size=floor(random(50,200));hc=random(pallette);vc=random(pallette);composite=["source-over","destination-out","source-atop"];return repeat(size,size,function(ctx,x,y){var sx,sy;ctx.randomFillStyle(pallette);ctx.globalCompositeOperation=random(composite);sx=size*floor(random(4));sy=size*floor(random(4));ctx.rotate(HALF_PI*floor(random(4)));ctx.globalAlpha=random(.5,1);return ctx.fillRect(0,0,sx,sy)})},star:function(){var jitter,make,scale,scatter,size;scatter=chance(.5);scale=random(.2,1.2);size=random(80,200);jitter=random(.2);make=function(ctx){var innerRad,offset,outerRad,points,radius,shape,step,theta;points=round(random(5,8));outerRad=random(5,60);innerRad=outerRad*random(.1,.6);theta=0;step=TWO_PI/(points*2);shape=[];offset=random(jitter);while(theta<TWO_PI){radius=outerRad*random(1-offset,1+offset);shape.push({x:radius*cos(theta),y:radius*sin(theta)});theta+=step;radius=innerRad*random(1-offset,1+offset);shape.push({x:radius*cos(theta),y:radius*sin(theta)});theta+=step}ctx.rotate(random(TWO_PI));ctx.scale(scale,scale);ctx.drawPath(shape);ctx.globalAlpha=random(.25,.8);ctx.randomFillStyle(pallette);return ctx.fill()};if(scatter){return distribute(random(.05,.15),width,height,make)}else{return repeat(size,size,make)}},tree:function(){var scatter,size,variants;variants=makeVariants(random(pallette),100,.2);distribute(random(.02,.05),width,height,function(ctx){var i,j,ref,results,sides,size,theta;sides=round(random(3,5));theta=PI/sides;size=random(4,20);ctx.lineWidth=random(1,5);ctx.rotate(random(TWO_PI));ctx.randomStrokeStyle(variants);results=[];for(i=j=1,ref=sides;1<=ref?j<=ref:j>=ref;i=1<=ref?++j:--j){ctx.beginPath();ctx.moveTo(-(size*random(.8,1.2)),0);ctx.lineTo(size*random(.8,1.2),0);ctx.stroke();results.push(ctx.rotate(theta+random(-.05,.05)))}return results});size=random(120,360);scatter=size*random(.2,.8);return repeat(size,size,function(ctx){var i,j,parts,pos,ref,results,scale;ctx.translate(random(scatter),random(scatter));parts=floor(random(2,6));size=random(10,60);pos=0;variants=makeVariants(random(pallette),10,.1);results=[];for(i=j=0,ref=parts;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j){size*=random(.8,.95);scale=size/100;pos-=size*random(.6,.9);ctx.save();ctx.translate(size*-.5,size*-.5);ctx.translate(0,pos);ctx.scale(scale*random(.8,1.2),scale*random(.8,1.2));ctx.rotate(PI*random(-.025,.025));ctx.drawShape(Shapes.triangle,2);ctx.randomFillStyle(variants);ctx.globalAlpha=random(.7,.95);ctx.fill();results.push(ctx.restore())}return results})},snow:function(){var make,scatter,size,snowflake;snowflake=function(){var branch,i,j,k,len,part,path,paths,ref,results,steps,theta,thickness,tree;tree=[];paths=[];thickness=random(10,20);tree.push(new Branch(tree,0,0,-HALF_PI,thickness));while(tree.length){i=tree.length;while(i--){if(!tree[i].growing){branch=tree.splice(i,1)[0];paths.push(branch.path)}}for(j=0,len=tree.length;j<len;j++){branch=tree[j];branch.grow()}}ctx.lineJoin="miter";steps=floor(random(3,8));theta=TWO_PI/steps;results=[];for(i=k=0,ref=steps-1;0<=ref?k<=ref:k>=ref;i=0<=ref?++k:--k){ctx.rotate(theta);results.push(function(){var len1,len2,len3,n,q,results1,u;results1=[];for(n=0,len1=paths.length;n<len1;n++){path=paths[n];ctx.beginPath();ctx.moveTo(path[0].x,path[0].y);for(q=0,len2=path.length;q<len2;q++){part=path[q];ctx.lineTo(part.x,part.y)}ctx.lineWidth=part.t;ctx.stroke();ctx.save();ctx.scale(-1,1);ctx.beginPath();ctx.moveTo(path[0].x,path[0].y);for(u=0,len3=path.length;u<len3;u++){part=path[u];if(part.t!==thickness){ctx.lineTo(part.x,part.y)}}ctx.lineWidth=part.t;ctx.stroke();results1.push(ctx.restore())}return results1}())}return results};ctx.shadowColor="rgba(0,0,0,0.1)";ctx.shadowOffsetX=2;ctx.shadowOffsetY=2;make=function(ctx){var scale,variants;variants=makeVariants(random(pallette),10,.1);scale=random(.05,.4);ctx.scale(scale,scale);ctx.rotate(random(TWO_PI));ctx.randomStrokeStyle(variants);return snowflake()};scatter=chance(.5);size=random(80,240);if(scatter){return distribute(random(.05,.1),width,height,make)}else{return repeat(size,size,make)}},scales:function(){var radius,size,stroke,type,variants;size=random(80,120);radius=size*random(.5,1);variants=makeVariants(random(pallette),100,random(.1,.2));stroke=chance(.5);type=random(["dot","rect"]);ctx.globalAlpha=random(.5,.9);ctx.lineWidth=radius*random(.1,.8);ctx.shadowColor="rgba(0,0,0,"+random(.25)+")";ctx.shadowOffsetX=random(-4,4);ctx.shadowOffsetY=random(-4,4);return repeat(size,size,function(ctx){switch(type){case"dot":ctx.dot(0,0,radius);break;case"rect":ctx.rotate(HALF_PI*-.5);ctx.rect(-radius,-radius,radius*2,radius*2)}ctx.randomFillStrokeStyle(variants);if(stroke){return ctx.stroke()}else{return ctx.fill()}})},polka:function(){var cc,scale,scatter,size,variants;variants=makeVariants(random(pallette),100,.1);scatter=chance(.5);cc=random(.2,1);if(scatter){size=random(50,120);return distribute(random(.05,.2),width,height,function(ctx){ctx.randomFillStyle(chance(cc)?variants:pallette);ctx.fillStyle="#ccc";ctx.globalAlpha=random();ctx.dot(0,0,random(size));return ctx.fill()})}else{size=random(50,200);scale=random(.5,1.2);return repeat(size,size,function(ctx){ctx.randomFillStyle(chance(cc)?variants:pallette);ctx.globalAlpha=random();ctx.dot(0,0,random(size*scale));return ctx.fill()})}},dot:function(){var dark,maxSize,minSize,origin,scatter,size,squares;size=random(20,200);minSize=size*random(.1,.2);maxSize=size*random(.5,1);scatter=random(.5);origin=chance(.3);squares=chance(.5);dark=background[2]<40;return repeat(size,size,function(ctx){var radius,scale;if(squares){ctx.randomFillStyle(pallette);ctx.globalAlpha=random(.1,.8);ctx.fillRect(size*-.5,size*-.5,size,size)}ctx.randomFillStyle(pallette);radius=random(minSize,maxSize);if(squares){radius=min(radius,size*.5)}scale=radius/50;if(origin){ctx.dot(0,0,radius*random(.05,.1));ctx.globalAlpha=random(.1,.4);ctx.fill()}ctx.rotate(random(TWO_PI));ctx.scale(scale,scale);ctx.translate(-50,-50);ctx.drawShape(Shapes.circle,3);ctx.globalAlpha=random(.4,.9);return ctx.fill()})},leaf:function(){var endRadius,fillChance,hsl,maxSteps,rings,scatter,shape,size,startRadius,stepRadius,variants;hsl=random(pallette);variants=makeVariants(hsl,100,.1);scatter=chance(.35);shape=function(ctx,length){var t,x1a,x1b,x2a,x2b;t=length*random(.2,.4);x1a=length*random(.2,.4);x2a=length*random(.5,.7);x1b=x1a*random(.8,1.2);x2b=x2a*random(.8,1.2);ctx.beginPath();ctx.moveTo(0,0);ctx.bezierCurveTo(t,x1a,t,x2a,0,length);ctx.bezierCurveTo(-t,x2b,-t,x1b,0,0);return ctx.closePath()};if(scatter){return distribute(.25,width,height,function(ctx){ctx.randomFillStyle(chance(.75)?variants:pallette);ctx.rotate(random(TWO_PI));shape(ctx,chance(.15)?random(80,220):random(40,80));ctx.globalAlpha=random(.6,.95);return ctx.fill()})}else{size=random(100,400);rings=random(3,8);startRadius=random(20);endRadius=size*random(.2,.5);stepRadius=(endRadius-startRadius)/rings;maxSteps=random(10,30);fillChance=random(.5,1);return repeat(size,size,function(ctx){var fill,h,j,l,numSteps,progress,radius,ref,ref1,ref2,results,s,theta,thetaStep,thickness;hsl=random(pallette);variants=makeVariants(hsl,20,.1);thickness=random(1,4);fill=chance(fillChance);results=[];for(radius=j=ref=startRadius,ref1=endRadius,ref2=stepRadius;ref2>0?j<=ref1:j>=ref1;radius=j+=ref2){progress=radius/endRadius;numSteps=2+progress*maxSteps;thetaStep=TWO_PI/numSteps;size=random(10,40+20*(1-progress));results.push(function(){var k,ref3,ref4,ref5,results1;results1=[];for(theta=k=0,ref3=TWO_PI,ref4=thetaStep;ref4>0?k<=ref3:k>=ref3;theta=k+=ref4){ref5=random(variants),h=ref5[0],s=ref5[1],l=ref5[2];ctx.save();ctx.rotate(theta);ctx.translate(radius,0);ctx.rotate(-HALF_PI);shape(ctx,size);ctx.globalAlpha=random(.6,.9);if(fill){ctx.fillStyle="hsl("+h+","+s+"%,"+l+"%)";ctx.fill()}else{ctx.strokeStyle="hsl("+h+","+s+"%,"+l+"%)";ctx.lineWidth=thickness;ctx.stroke()}results1.push(ctx.restore())}return results1}())}return results})}},tri:function(){var alpha,hsl,lower,margin,overlays,size,size2,sizeM,upper,variants;hsl=random(pallette);size=random(40,100);alpha=random(.6,.8);margin=4*floor(random(3));variants=makeVariants(hsl,100,.1);overlays=random([variants,pallette]);upper=chance(.5);lower=!upper?true:chance(.5);size2=size*2;sizeM=size-margin;return repeat(size,size,function(ctx){if(upper){ctx.tri(margin,margin,sizeM,margin,sizeM,sizeM);ctx.globalAlpha=1;ctx.randomFillStyle(variants);ctx.fill();ctx.tri(0,0,size2,size2,0,size2);ctx.globalAlpha=alpha;ctx.randomFillStyle(overlays);ctx.fill()}if(lower){ctx.tri(margin,margin,sizeM,sizeM,margin,sizeM);ctx.globalAlpha=1;ctx.randomFillStyle(variants);ctx.fill();ctx.tri(0,0,size2,0,size2,size2);ctx.globalAlpha=alpha;ctx.randomFillStyle(overlays);return ctx.fill()}})},bead:function(){var backgroundLight,bg,density,offsetR,shadow,shape,sizeX,snow;bg=background;backgroundLight="hsla("+bg[0]+","+bg[1]+"%,"+bg[2]*1.5+"%,0.5)";ctx.strokeStyle=backgroundLight;ctx.lineWidth=1;ctx.lineCap="round";shape=Shapes[chance(.5)?"teardrop":"teardrop2"];sizeX=shape===Shapes.teardrop?40:45;offsetR=random(.1,1);density=random(.1,1);shadow=chance(.5);snow=chance(.5);if(snow){distribute(.1,width,height,function(ctx){ctx.dot(0,0,random(2,6));ctx.globalAlpha=random(.5,.8);ctx.fillStyle=backgroundLight;return ctx.fill()})}if(shadow){ctx.shadowColor="rgba(0,0,0,0.1)";ctx.shadowOffsetX=0;ctx.shadowOffsetY=random(2,8)}return repeat(random(80,100),height,function(ctx){var results,scale,size,y;ctx.translate(random(80*offsetR),0);y=0;results=[];while(y<height){size=chance(.2)?random(160,220):random(5,120);scale=size/100;ctx.save();ctx.translate(scale*-sizeX,y);ctx.scale(scale,scale);ctx.drawShape(shape);ctx.globalAlpha=random(.5,.9);ctx.randomFillStyle(pallette);ctx.fill();ctx.restore();y+=size;ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(0,y+=random(5,50*density));results.push(ctx.stroke())}return results})}}}}();THREE.Vector3.prototype.makeParticle=function(){this.mass=1;this.massInv=1/this.mass;this.fixed=false;this.old=this.clone();this.acc=new THREE.Vector3;this.vel=new THREE.Vector3;return this.tmp=new THREE.Vector3};THREE.Vector3.prototype.integrate=function(dtSq){if(this.fixed){return}this.acc.multiplyScalar(this.massInv);this.vel.sub(this,this.old);this.vel.multiplyScalar(.8);this.acc.multiplyScalar(dtSq);this.vel.addSelf(this.acc);this.tmp.add(this,this.vel);this.old.copy(this);this.copy(this.tmp);return this.acc.set(0,0,0)};Spring=function(){function Spring(p1,p2,restlength,stiffness){this.p1=p1!=null?p1:new THREE.Vector3;this.p2=p2!=null?p2:new THREE.Vector3;this.restlength=restlength!=null?restlength:10;this.stiffness=stiffness!=null?stiffness:1;this.delta=new THREE.Vector3}Spring.prototype.update=function(){var copy,dist,force;this.delta.sub(this.p2,this.p1);dist=this.delta.length()+1e-6;force=(dist-this.restlength)/(dist*(this.p1.massInv+this.p2.massInv))*this.stiffness;if(!this.p1.fixed){copy=this.delta.clone();copy.multiplyScalar(force*this.p1.massInv);this.p1.addSelf(copy)}if(!this.p2.fixed){this.delta.multiplyScalar(-force*this.p2.massInv);return this.p2.addSelf(this.delta)}};return Spring}();Scene=function(){Scene.prototype.currentPosition=new THREE.Vector3(0,0,-150);Scene.prototype.nextPosition=new THREE.Vector3(0,0,-300);Scene.prototype.oldPosition=new THREE.Vector3(0,0,0);function Scene(){this.scene=new THREE.Scene;this.mouse=new THREE.Vector3;this.delta=new THREE.Vector3;this.distance=0;this.dragging=false;this.current=null;this.next=null;this.anchor=new THREE.Vector3;this.anchor.makeParticle();this.anchor.fixed=true;this.springs=[];this.active=[];this.lights()}Scene.prototype.init=function(){var i;this.sheets=function(){var j,results;results=[];for(i=j=0;j<=5;i=++j){results.push(new Paper)}return results}();this.pool=this.sheets.concat();this.next=this.pool.pop();this.next.moveTo(this.currentPosition);this.next.build();this.next.changePattern();this.active.push(this.next);return this.nextSheet()};Scene.prototype.lights=function(){this.ambient=new THREE.AmbientLight(16777215);this.spot=new THREE.SpotLight(16777215,2,0,PI*.5,50);this.spot.position.set(500,3e3,2500);this.spot.lookAt(new THREE.Vector3);this.spot.shadowMapHeight=512*8;this.spot.shadowMapWidth=512*8;this.spot.shadowDarkness=.25;this.spot.castShadow=true;this.scene.add(this.ambient);return this.scene.add(this.spot)};Scene.prototype.nextSheet=function(){var ref,sheet;if((ref=this.current)!=null){ref.easeTo(this.oldPosition)}while(this.pool.length<2){sheet=this.active.shift();this.scene.remove(sheet);this.pool.unshift(sheet)}this.current=this.next;this.next=this.pool.pop();this.current.easeTo(this.currentPosition);this.next.moveTo(this.nextPosition);this.next.build();this.next.changePattern();this.scene.add(this.current);this.scene.add(this.next);this.active.push(this.next);return this.distance=0};Scene.prototype.startDrag=function(){var connections,distance,index,j,ref,results,vertex,vertices;if(!this.current){return}this.dragging=true;this.anchor.copy(this.mouse);vertices=this.current.geometry.vertices.concat();vertices.sort(function(_this){return function(a,b){return a.distanceTo(_this.anchor)-b.distanceTo(_this.anchor)}}(this));connections=floor(random(20,80));results=[];for(index=j=0,ref=connections;0<=ref?j<=ref:j>=ref;index=0<=ref?++j:--j){vertex=vertices[index];distance=this.anchor.distanceTo(vertex);results.push(this.springs.push(new Spring(this.anchor,vertex,distance*random(.8,.9),random(.4,.7))))}return results};Scene.prototype.stopDrag=function(){this.dragging=false;this.springs=[];if(this.distance>800){this.current.drop();return this.nextSheet()}};Scene.prototype.update=function(dtSq){var j,k,len,len1,paper,ref,ref1,results,spring;if(this.dragging){this.distance+=this.delta.length()}this.delta.sub(this.mouse,this.anchor);this.delta.multiplyScalar(.08);this.anchor.addSelf(this.delta);ref=this.active;for(j=0,len=ref.length;j<len;j++){paper=ref[j];paper.update(dtSq)}ref1=this.springs;results=[];for(k=0,len1=ref1.length;k<len1;k++){spring=ref1[k];results.push(spring.update(dtSq))}return results};Scene.prototype.resize=function(){var j,len,ref,results,sheet;ref=this.sheets;results=[];for(j=0,len=ref.length;j<len;j++){sheet=ref[j];results.push(sheet.resize())}return results};return Scene}();Shapes=function(){var c,l,m;m="moveTo";l="lineTo";c="bezierCurveTo";return{random:function(){var key,shapes,val;shapes=function(){var ref,results;ref=this;results=[];for(key in ref){val=ref[key];if(val instanceof Array){results.push(key)}}return results}.call(this);return this[shapes[Math.random()*shapes.length|0]]},triangle:[[m,2.5,91.4],[c,2.4,83,9.6,74,13.7,67.4],[c,20.3,56.6,26.9,45.6,33.2,34.6],[c,37.1,27.9,40,20.5,43.7,13.6],[c,46,9.4,48.5,5.2,50.2,.7],[c,55.5,3.4,58.9,10.7,61.3,16.3],[c,63.5,21.2,63.5,26.3,65.2,32],[c,67,37.8,69.7,40.7,73,45.2],[c,80.2,54.9,84.7,67.9,91.1,78.4],[c,94.9,84.5,93.8,96.5,100.7,100.7],[c,81.7,100.1,62.7,99.6,43.8,99.6],[c,34.6,99.6,23.4,101.2,14.4,98.4],[c,9.8,96.9,5.9,96.5,.7,96.2],[c,.7,96.1,.7,94.9,.7,94.7],[c,.7,94.7,1.9,93,2.5,91.4]],circle:[[m,100.5,51.8],[c,100.5,41.3,94.8,23.4,87.1,16.1],[c,80.3,9.7,61.8,-2.3,52.4,1.1],[c,26.9,2.8,2,17.4,.6,46.2],[c,-.1,59.7,3.5,74.3,12.1,85.1],[c,19.2,94,38.8,101.7,49.4,100.3],[c,65.3,98.3,72.4,95.9,84,85.5],[c,93.7,76.8,100.5,64.4,100.5,51.8]],teardrop:[[m,64.1,22.3],[c,62.1,20.7,40.5,.7,40.5,.7],[c,40.5,.7,18.9,20.7,16.9,22.3],[c,14.9,23.9,-.3,38.5,.5,48.8],[c,1.4,59.2,2.3,66.7,20.5,82.4],[c,38.7,98.2,39.1,99.5,40.5,100.7],[c,41.9,99.5,42.3,98.2,60.5,82.4],[c,78.7,66.7,79.6,59.2,80.5,48.8],[c,81.3,38.5,66.1,23.9,64.1,22.3]],teardrop2:[[m,45.1,.3],[c,49.5,5.5,61.9,8.1,67.9,11.9],[c,79.7,19.4,88.9,30,90.3,42.8],[c,91.7,56.3,86,71.6,74.3,81],[c,65.6,88,53.7,89.8,47.6,99],[c,47.4,99.2,45.7,101.9,43.4,99],[c,37.3,89.8,25.4,88,16.7,81],[c,5,71.6,-.7,56.3,.7,42.8],[c,2.1,30,11.3,19.4,23.1,11.9],[c,29.1,8.1,40.8,5.5,45.1,.3]],triangle:[[m,.6,99.2],[c,-.5,90.1,7,82.3,10.5,74.6],[c,14.5,65.5,18.8,58.8,24.6,50.8],[c,29.9,43.6,32.8,33,37.4,25],[c,41.7,17.4,47.9,9.7,50.5,1.2],[c,61.2,19.6,69.5,40.5,81.7,57.7],[c,91.9,72,95,84.9,100.5,101.2],[c,82.8,101.8,64.8,98.6,47.1,98.3],[c,32.4,98.1,15,95.3,.6,99.2]]}}();Sprites=function(){var canvas,image,name,slice,slices;canvas={};slices={a:{x:0,y:0,w:140,h:170},b:{x:150,y:0,w:165,h:161},c:{x:323,y:0,w:91,h:157},d:{x:10,y:178,w:114,h:97},e:{x:9,y:283,w:115,h:82},f:{x:138,y:189,w:78,h:93},g:{x:130,y:300,w:96,h:65},h:{x:238,y:199,w:176,h:167}};for(name in slices){slice=slices[name];canvas[name]=new Image}image=new Image;image.onload=function(_this){return function(){var ctx,img,results;results=[];for(name in slices){slice=slices[name];img=document.createElement("canvas");img.height=slice.h;img.width=slice.w;ctx=img.getContext("2d");ctx.drawImage(image,slice.x,slice.y,slice.w,slice.h,0,0,slice.w,slice.h);results.push(canvas[name]=img)}return results}}(this);image.src="build/img/sprites.png";return{canvas:canvas,random:function(){return canvas[random(function(){var results;results=[];for(name in canvas){results.push(name)}return results}())]}}}();themes=[["FCF2C6","99BAA4","608E93","50596C","2F2D3E"],["AAB3AB","C4CBB7","EBEFC9","EEE0B7","E8CAAF"],["951F2B","F5F4D7","E0DFB1","A5A36C","535233"],["A32C28","1C090B","384030","7B8055","BCA875"],["E8C382","B39D69","A86B4C","7D1A0C","340A0B"],["A22C27","4F2621","9F8241","EBD592","929867"],["CB150B","DD4F71","EBB289","FDE0B7","7A7E5F"],["941F1F","CE6B5D","FFEFB9","7B9971","34502B"],["9E3333","AB6060","D4D1A5","7BBD82","3D9949"],["85B394","A7BA59","F0F0D8","F0D890","AE2F27"],["FCF2C6","99BAA4","608E93","50596C","2F2D3E"],["F5EA95","FC8E5B","FC5956","C93E4F","3D1734"],["7C1F1F","AD9E6D","8B8557","4A4F23","1C2113"],["4E3906","437600","A9CD02","FDFFDB","A70006"],["FF8B38","F85466","F02999","BF5198","8D839B"],["717A51","7D6745","753830","B46971","FADEE0"],["E2F7E0","73FFA8","6BE34E","7C9E21","AB1B1C"],["FB573B","4F393C","8EA88D","9CD0AC","F4EB9E"],["BFAA73","9C9968","948E41","9C6B3A","B10408"],["B6E1C3","B9E667","B1D967","A3C856","E5FCB8"],["C1E142","E3AF58","F58667","F8376A","362A1E"]];utils=function(){return{hex2rgb:function(hex){var rgb;rgb=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return[parseInt(rgb[1],16),parseInt(rgb[2],16),parseInt(rgb[3],16)]},rgb2hex:function(r,g,b){return"#"+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1)},hex2hsl:function(hex){var b,g,r,ref;ref=utils.hex2rgb(hex),r=ref[0],g=ref[1],b=ref[2];return utils.rgb2hsl(r,g,b)},rgb2hsl:function(r,g,b){var d,h,l,mn,mx,s;r/=255;g/=255;b/=255;mn=min(r,g,b);mx=max(r,g,b);l=.5*(mn+mx);if(mx===mn){h=s=0}else{d=mx-mn;s=l>.5?d/(2-mx-mn):d/(mx+mn);switch(mx){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}h=round(h*360);s=round(s*100);l=round(l*100);return[h,s,l]}}}();width=window.innerWidth;height=window.innerHeight;scale=window.devicePixelRatio||1;aspect=width/height;distance=1200;renderer=new THREE.WebGLRenderer({antialias:true});camera=new THREE.PerspectiveCamera(75,aspect,1,1e4);scene=new Scene;clock=+new Date;drag=new THREE.Vector3;stats=typeof Stats==="function"?new Stats:void 0;composer=null;init=function(){var effectCopy,effectFilm,renderModel;if(stats!=null){document.body.appendChild(stats.domElement);stats.domElement.style.position="absolute";stats.domElement.style.left="0px";stats.domElement.style.top="0px";stats.setMode(0)}renderer.shadowMapEnabled=true;renderer.shadowMapCascade=true;renderer.shadowMapSoft=true;renderer.setClearColor(1118481);renderer.autoClear=false;renderer.gammaInput=true;renderer.gammaOutput=true;renderModel=new THREE.RenderPass(scene.scene,camera);effectFilm=new THREE.FilmPass(.12,0,0,false);effectCopy=new THREE.ShaderPass(THREE.CopyShader);effectCopy.renderToScreen=true;composer=new THREE.EffectComposer(renderer);composer.addPass(renderModel);composer.addPass(effectFilm);composer.addPass(effectCopy);camera.position.z=distance;renderer.domElement.style.width="100%";renderer.domElement.style.height="100%";document.body.appendChild(renderer.domElement);window.addEventListener("touchstart",mousedown);window.addEventListener("mousedown",mousedown);window.addEventListener("touchmove",mousemove);window.addEventListener("mousemove",mousemove);window.addEventListener("touchend",mouseup);window.addEventListener("mouseup",mouseup);window.addEventListener("resize",resize);scene.init();resize();return update()};update=function(){var dt,dtSq,now;if(stats!=null){stats.begin()}now=+new Date;dt=now-clock;dtSq=dt*dt;clock=now;scene.update(dtSq);renderer.clear();composer.render(dt/1e3);requestAnimationFrame(update);return stats!=null?stats.end():void 0};mousedown=function(e){renderer.domElement.className="grabbing";drag=scene.mouse.clone();mousemove(e);e.preventDefault();return scene.startDrag()};mouseup=function(e){renderer.domElement.className="";e.preventDefault();return scene.stopDrag()};mousemove=function(e){var diagonal,pos;e.preventDefault();pos=e.touches?e.touches[0]:e;scene.mouse.x=1.5*(width*-.5+(pos.clientX||0));scene.mouse.y=1.5*(height*.5-(pos.clientY||0));if(scene.dragging){distance=drag.distanceTo(scene.mouse);diagonal=sqrt(width*width+height*height);return scene.mouse.z=300*(distance/diagonal)}};resize=function(){width=window.innerWidth;height=window.innerHeight;renderer.setSize(width*scale,height*scale);camera.aspect=width/height;camera.updateProjectionMatrix();return scene.resize()};init()}).call(this);